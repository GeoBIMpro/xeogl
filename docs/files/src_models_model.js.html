<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/models/model.js - xeogl</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link href='https://fonts.googleapis.com/css?family=Exo+2:400,800,900,700,600,500|Roboto:100,300,400,500,700,900'  rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">

                <h1 class="projectTitle"><a href="../../">xeogl</a> / <a href="../../docs">API Docs</a></h1>

        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AABBGeometry.html">AABBGeometry</a></li>
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/Billboard.html">Billboard</a></li>
                                <li><a href="../classes/Boundary2D.html">Boundary2D</a></li>
                                <li><a href="../classes/Boundary3D.html">Boundary3D</a></li>
                                <li><a href="../classes/BoundingSphereGeometry.html">BoundingSphereGeometry</a></li>
                                <li><a href="../classes/BoxGeometry.html">BoxGeometry</a></li>
                                <li><a href="../classes/BuildableModel.html">BuildableModel</a></li>
                                <li><a href="../classes/Camera.html">Camera</a></li>
                                <li><a href="../classes/CameraControl.html">CameraControl</a></li>
                                <li><a href="../classes/CameraController.html">CameraController</a></li>
                                <li><a href="../classes/CameraFlightAnimation.html">CameraFlightAnimation</a></li>
                                <li><a href="../classes/CameraFollowAnimation.html">CameraFollowAnimation</a></li>
                                <li><a href="../classes/CameraPath.html">CameraPath</a></li>
                                <li><a href="../classes/CameraPathAnimation.html">CameraPathAnimation</a></li>
                                <li><a href="../classes/Canvas.html">Canvas</a></li>
                                <li><a href="../classes/Clip.html">Clip</a></li>
                                <li><a href="../classes/Clips.html">Clips</a></li>
                                <li><a href="../classes/ColorBuf.html">ColorBuf</a></li>
                                <li><a href="../classes/Component.html">Component</a></li>
                                <li><a href="../classes/Configs.html">Configs</a></li>
                                <li><a href="../classes/CubicBezierCurve.html">CubicBezierCurve</a></li>
                                <li><a href="../classes/Cull.html">Cull</a></li>
                                <li><a href="../classes/Curve.html">Curve</a></li>
                                <li><a href="../classes/CylinderGeometry.html">CylinderGeometry</a></li>
                                <li><a href="../classes/DepthBuf.html">DepthBuf</a></li>
                                <li><a href="../classes/DirLight.html">DirLight</a></li>
                                <li><a href="../classes/Entity.html">Entity</a></li>
                                <li><a href="../classes/Fresnel.html">Fresnel</a></li>
                                <li><a href="../classes/Frustum.html">Frustum</a></li>
                                <li><a href="../classes/Geometry.html">Geometry</a></li>
                                <li><a href="../classes/GeometryBuilder.html">GeometryBuilder</a></li>
                                <li><a href="../classes/GLTFModel.html">GLTFModel</a></li>
                                <li><a href="../classes/HeightmapGeometry.html">HeightmapGeometry</a></li>
                                <li><a href="../classes/Input.html">Input</a></li>
                                <li><a href="../classes/KeyboardAxisCamera.html">KeyboardAxisCamera</a></li>
                                <li><a href="../classes/KeyboardPanCamera.html">KeyboardPanCamera</a></li>
                                <li><a href="../classes/KeyboardRotateCamera.html">KeyboardRotateCamera</a></li>
                                <li><a href="../classes/KeyboardZoomCamera.html">KeyboardZoomCamera</a></li>
                                <li><a href="../classes/Layer.html">Layer</a></li>
                                <li><a href="../classes/Lights.html">Lights</a></li>
                                <li><a href="../classes/Lookat.html">Lookat</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Modes.html">Modes</a></li>
                                <li><a href="../classes/MousePanCamera.html">MousePanCamera</a></li>
                                <li><a href="../classes/MousePickEntity.html">MousePickEntity</a></li>
                                <li><a href="../classes/MouseRotateCamera.html">MouseRotateCamera</a></li>
                                <li><a href="../classes/MouseZoomCamera.html">MouseZoomCamera</a></li>
                                <li><a href="../classes/Nintendo3DSGeometry.html">Nintendo3DSGeometry</a></li>
                                <li><a href="../classes/OBBGeometry.html">OBBGeometry</a></li>
                                <li><a href="../classes/OBJGeometry.html">OBJGeometry</a></li>
                                <li><a href="../classes/Ortho.html">Ortho</a></li>
                                <li><a href="../classes/Path.html">Path</a></li>
                                <li><a href="../classes/PathGeometry.html">PathGeometry</a></li>
                                <li><a href="../classes/Perspective.html">Perspective</a></li>
                                <li><a href="../classes/PhongMaterial.html">PhongMaterial</a></li>
                                <li><a href="../classes/PlaneGeometry.html">PlaneGeometry</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/QuadraticBezierCurve.html">QuadraticBezierCurve</a></li>
                                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
                                <li><a href="../classes/Rotate.html">Rotate</a></li>
                                <li><a href="../classes/Scale.html">Scale</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/SceneJSModel.html">SceneJSModel</a></li>
                                <li><a href="../classes/Skybox.html">Skybox</a></li>
                                <li><a href="../classes/SphereGeometry.html">SphereGeometry</a></li>
                                <li><a href="../classes/Spinner.html">Spinner</a></li>
                                <li><a href="../classes/SplineCurve.html">SplineCurve</a></li>
                                <li><a href="../classes/Stage.html">Stage</a></li>
                                <li><a href="../classes/Stationary.html">Stationary</a></li>
                                <li><a href="../classes/StereoEffect.html">StereoEffect</a></li>
                                <li><a href="../classes/TeapotGeometry.html">TeapotGeometry</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/TorusGeometry.html">TorusGeometry</a></li>
                                <li><a href="../classes/Transform.html">Transform</a></li>
                                <li><a href="../classes/Translate.html">Translate</a></li>
                                <li><a href="../classes/VectorTextGeometry.html">VectorTextGeometry</a></li>
                                <li><a href="../classes/Viewport.html">Viewport</a></li>
                                <li><a href="../classes/Visibility.html">Visibility</a></li>
                                <li><a href="../classes/xeogl.html">xeogl</a></li>
                                <li><a href="../classes/xeogl.math.math.html">xeogl.math.math</a></li>
                                <li><a href="../classes/ZSpaceEffect.html">ZSpaceEffect</a></li>
                                <li><a href="../classes/ZSpaceStylusControl.html">ZSpaceStylusControl</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="..//modules/animation.html">animation</a></li>
                                <li><a href="..//modules/boundaries.html">boundaries</a></li>
                                <li><a href="..//modules/camera.html">camera</a></li>
                                <li><a href="..//modules/canvas.html">canvas</a></li>
                                <li><a href="..//modules/clipping.html">clipping</a></li>
                                <li><a href="..//modules/configs.html">configs</a></li>
                                <li><a href="..//modules/controls.html">controls</a></li>
                                <li><a href="..//modules/culling.html">culling</a></li>
                                <li><a href="..//modules/curves.html">curves</a></li>
                                <li><a href="..//modules/effects.html">effects</a></li>
                                <li><a href="..//modules/entities.html">entities</a></li>
                                <li><a href="..//modules/generation.html">generation</a></li>
                                <li><a href="..//modules/geometry.html">geometry</a></li>
                                <li><a href="..//modules/input.html">input</a></li>
                                <li><a href="..//modules/interaction.html">interaction</a></li>
                                <li><a href="..//modules/lighting.html">lighting</a></li>
                                <li><a href="..//modules/materials.html">materials</a></li>
                                <li><a href="..//modules/math.html">math</a></li>
                                <li><a href="..//modules/models.html">models</a></li>
                                <li><a href="..//modules/rendering.html">rendering</a></li>
                                <li><a href="..//modules/skyboxes.html">skyboxes</a></li>
                                <li><a href="..//modules/transforms.html">transforms</a></li>
                                <li><a href="..//modules/xeogl.html">xeogl</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <!--<div id="api-options">-->
                    <!--Show:-->
                    <!--<label for="api-show-inherited">-->
                        <!--<input type="checkbox" id="api-show-inherited" checked>-->
                        <!--Inherited-->
                    <!--</label>-->
            
                    <!--<label for="api-show-protected">-->
                        <!--<input type="checkbox" id="api-show-protected">-->
                        <!--Protected-->
                    <!--</label>-->
            
                    <!--<label for="api-show-private">-->
                        <!--<input type="checkbox" id="api-show-private">-->
                        <!--Private-->
                    <!--</label>-->
                    <!--<label for="api-show-deprecated">-->
                        <!--<input type="checkbox" id="api-show-deprecated">-->
                        <!--Deprecated-->
                    <!--</label>-->
            
                <!--</div>-->
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/models/model.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function () {

    &quot;use strict&quot;;

    /**
     A **Model** is a group of {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} within a xeogl {{#crossLink &quot;Scene&quot;}}{{/crossLink}}.

     ## Overview

     * A Model manages the lifecycle of its components, automatically deleting them when the Model is deleted.
     * Can be attached to a hierarchy of {{#crossLink &quot;Transform&quot;}}Transforms{{/crossLink}}, to transform its components as a group, within World-space.
     * Provides the collective World-space boundary of its components as a {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}}, which
     updates its extents automatically as components are added and removed, or Transforms are updated.

     A Model is subclassed by (at least):

     * {{#crossLink &quot;GLTFModel&quot;}}{{/crossLink}}, which loads its components from glTF files.
     * {{#crossLink &quot;SceneJSModel&quot;}}{{/crossLink}}, which loads its components from SceneJS scene definitions.
     * {{#crossLink &quot;BuildableModel&quot;}}{{/crossLink}}, which provides a fluent API for building its components.

     &lt;img src=&quot;../../../assets/images/Model.png&quot;&gt;&lt;/img&gt;

     ## Usage

     ### Adding and removing components to a Model

     When adding components to a Model, it&#x27;s usually easiest to just add their configuration objects and let the Model
     internally instantiate them, as shown below.

     Note that a Model manages the lifecycles of all the components contained within it, destroying them when we destroy
     the Model or call its {{#crossLink &quot;Model/destroyAll:method&quot;}}{{/crossLink}} method.

     &#x60;&#x60;&#x60;&#x60;javascript
     var model = new xeogl.Model();

     var geometry = model.add({
            type: &quot;xeogl.TorusGeometry&quot;
        });

     var material = model.add({
            type: &quot;xeogl.PhongMaterial&quot;
            diffuse: [0.4, 0.4, 9.0]
        });

     model.add({
            type: &quot;xeogl.Entity&quot;,
            geometry: geometry,
            material: material
        });
     &#x60;&#x60;&#x60;&#x60;

     As shown below, we can also add our own component instances, supplying either the objects or their IDs.

     Note that the components must be in the same {{#crossLink &quot;Scene&quot;}}{{/crossLink}} as the model.

     &#x60;&#x60;&#x60;&#x60;javascript
     // Add our component object
     model.add(new xeogl.Entity({
            geometry: geometry,
            material: material
        }));

     // Instantiate our component and add it by ID:
     var material2 = new xeogl.PhongMaterial({
            id: &quot;myMaterial&quot;,
            diffuse: [0.4, 1.0, 9.0]
        });

     model.add(&quot;myMaterial&quot;);
     &#x60;&#x60;&#x60;&#x60;

     Since xeogl aims to be as declarative as possible, we can also add components immediately,
     via the Model&#x27;s constructor:

     &#x60;&#x60;&#x60;&#x60;javascript
     // We can add components immediately, via the Model&#x27;s
     var model2 = new xeogl.Model({
            components: [
                {
                    type: &quot;xeogl.TorusGeometry&quot;
                    id: &quot;myTorusGeometry&quot;
                },
                {
                    type: &quot;xeogl.PhongMaterial&quot;
                    id: &quot;myPhongMaterial&quot;,
                    diffuse: [0.4, 0.4, 9.0]
                },
                {
                    type: &quot;xeogl.Entity&quot;,
                    geometry: &quot;myTorusGeometry&quot;,
                    material: &quot;myPhongMaterial&quot;
                }
            ]
        });
    &#x60;&#x60;&#x60;&#x60;

     ### Transforming a Model

     As well as allowing us organize the lifecycle of groups of components, a Model also lets us transform them as a group.

     We can attach a modeling {{#crossLink &quot;Transform&quot;}}{{/crossLink}} to our Model, as a either a
     configuration object or a component instance:

     &#x60;&#x60;&#x60;&#x60; Javascript
     // Attach transforms as a configuration object:
     model.transform = {
        type: &quot;xeogl.Translate&quot;,
        xyz: [-35, 0, 0],
        parent: {
            type: &quot;xeogl.Rotate&quot;,
            xyz: [0, 1, 0],
            angle: 45
        }
     };

     // Attach our own transform instances:
     model.transform = new xeogl.Translate({
        xyz: [-35, 0, 0],
        parent: new xeogl.Rotate({
            xyz: [0, 1, 0],
            angle: 45
        })
     });
     &#x60;&#x60;&#x60;&#x60;

     We can also provide the transforms to the Model constructor, as either configuration objects or instances.

     Here we&#x27;ll provide them as configuration objects:

     &#x60;&#x60;&#x60;&#x60; Javascript
     // Model internally instantiates our transform components:
     var model3 = new xeogl.Model({
        transform: {
            type: &quot;xeogl.Translate&quot;,
            xyz: [-35, 0, 0],
            parent: {
                type: &quot;xeogl.Rotate&quot;,
                xyz: [0, 1, 0],
                angle: 45
            }
        }
     });

     &#x60;&#x60;&#x60;&#x60;

     Note that, as with the components we added before, the Model will manage the lifecycles of our transform components,
     destroying them when we destroy the Model or call its {{#crossLink &quot;Model/destroyAll:method&quot;}}{{/crossLink}} method.

     ### Getting the World-space boundary of a Model

     A Model&#x27;s {{#crossLink &quot;Model/worldBoundary:property&quot;}}{{/crossLink}} property is a {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}}
     that provides the collective World-space boundary of all its components. The {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} will
     automatically adjust its extents whenever we add or remove components to its Model, or whenever we update the Model&#x27;s transforms.

     Let&#x27;s get the {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} from our first Model, subscribe to changes on its extents,
     then animate one of the Model&#x27;s transforms, which will cause the {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} to fire an
     {{#crossLink &quot;Boundary3D/updated:event&quot;}}{{/crossLink}} each time its extents change:

     &#x60;&#x60;&#x60;&#x60; Javascript
     var worldBoundary = model.worldBoundary;

     worldBoundary.on(&quot;updated&quot;, function() {
        obb = worldBoundary.obb;
        aabb = worldBoundary.aabb;
        center = worldBoundary.center;
        sphere = worldBoundary.sphere();
        //...
    });

     model.scene.on(&quot;tick&quot;, function() {
            model.transform.parent.angle += 0.2;
        });
     &#x60;&#x60;&#x60;&#x60;

     Since xeogl is all about lazy-execution to avoid needless work, the {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} will
     only actually recompute its extents when we read its {{#crossLink &quot;Boundary3D/obb:property&quot;}}{{/crossLink}},
     {{#crossLink &quot;Boundary3D/aabb:property&quot;}}{{/crossLink}}, {{#crossLink &quot;Boundary3D/center:property&quot;}}{{/crossLink}},
      {{#crossLink &quot;Boundary3D/center:property&quot;}}{{/crossLink}} or
     {{#crossLink &quot;Boundary3D/sphere:property&quot;}}{{/crossLink}} properties.

     Also, the Model lazy-instantiates its {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} the first time we reference
     the Model&#x27;s {{#crossLink &quot;Model/worldBoundary:property&quot;}}{{/crossLink}} property. Since the {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}}
     is going to hang around in memory and fire {{#crossLink &quot;Boundary3D/updated:event&quot;}}{{/crossLink}} events each time we add or
     remove components, or animate transforms, for efficiency we should destroy the {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}}
     as soon as we no longer need it.

     Finally, when we destroy a Model, it will also destroy its {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}}, if it
     currently has one.

     @class Model
     @module xeogl
     @submodule models
     @constructor
     @param [scene] {Scene} Parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} - creates this ModelModel in the default
     {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}} when omitted.
     @param [cfg] {*} Configs
     @param [cfg.id] {String} Optional ID, unique among all components in the parent {{#crossLink &quot;Scene&quot;}}Scene{{/crossLink}},
     generated automatically when omitted.
     @param [cfg.meta] {String:Object} Optional map of user-defined metadata to attach to this ModelModel.
     @param [cfg.transform] {Number|String|Transform} A Local-to-World-space (modelling) {{#crossLink &quot;Transform&quot;}}{{/crossLink}} to attach to this Model.
     Must be within the same {{#crossLink &quot;Scene&quot;}}{{/crossLink}} as this Model. Internally, the given
     {{#crossLink &quot;Transform&quot;}}{{/crossLink}} will be inserted above each top-most {{#crossLink &quot;Transform&quot;}}Transform{{/crossLink}}
     that the Model attaches to its {{#crossLink &quot;Entity&quot;}}Entities{{/crossLink}}.
     @param [cfg.components] {Array} Array of {{#crossLink &quot;Components&quot;}}{{/crossLink}} to add initially, given as IDs, configuration objects or instances.
     @extends Component
     */
    xeogl.Model = xeogl.Component.extend({

        /**
         JavaScript class name for this Component.

         @property type
         @type String
         @final
         */
        type: &quot;xeogl.Model&quot;,

        _init: function (cfg) {

            /**
             * The {{#crossLink &quot;Components&quot;}}{{/crossLink}} within this Model, mapped to their IDs.
             *
             * Fires an {{#crossLink &quot;Model/updated:event&quot;}}{{/crossLink}} event on change.
             *
             * @property components
             * @type {{String:Component}}
             */
            this.components = {};

            /**
             * The number of {{#crossLink &quot;Components&quot;}}{{/crossLink}} within this Model.
             *
             * @property numComponents
             * @type Number
             */
            this.numComponents = 0;

            /**
             * A map of maps; for each {{#crossLink &quot;Component&quot;}}{{/crossLink}} type in this Model,
             * a map to IDs to {{#crossLink &quot;Component&quot;}}{{/crossLink}} instances, eg.
             *
             * &#x60;&#x60;&#x60;&#x60;
             * &quot;xeogl.Geometry&quot;: {
             *   &quot;alpha&quot;: &lt;xeogl.Geometry&gt;,
             *   &quot;beta&quot;: &lt;xeogl.Geometry&gt;
             * },
             * &quot;xeogl.Rotate&quot;: {
             *   &quot;charlie&quot;: &lt;xeogl.Rotate&gt;,
             *   &quot;delta&quot;: &lt;xeogl.Rotate&gt;,
             *   &quot;echo&quot;: &lt;xeogl.Rotate&gt;,
             * },
             * //...
             * &#x60;&#x60;&#x60;&#x60;
             *
             * @property types
             * @type {String:{String:xeogl.Component}}
             */
            this.types = {};

            // Subscriptions to &quot;destroyed&quot; events from components
            this._onDestroyed = {};

            // Subscriptions to &quot;updated&quot; events from components&#x27; worldBoundaries
            this._onWorldBoundaryUpdated = {};

            this._aabbDirty = true;

            // Dummy transform to make it easy to graft user-supplied transforms above added entities
            this._dummyRootTransform = this.create({
                type: &quot;xeogl.Transform&quot;,
                meta: &quot;dummy&quot;
            });

            this.transform = cfg.transform;

            if (cfg.components) {
                var components = cfg.components;
                for (var i = 0, len = components.length; i , len; i++) {
                    this.add(components[i]);
                }
            }
        },

        /**
         * Adds a {{#crossLink &quot;Component&quot;}}Component{{/crossLink}} or subtype to this Model.
         *
         * The {{#crossLink &quot;Component&quot;}}Component(s){{/crossLink}} may be specified by ID, instance, JSON definition or type.
         *
         * See class comment for usage examples.
         *
         * The {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} must be in the same {{#crossLink &quot;Scene&quot;}}{{/crossLink}} as this Model.
         *
         * Fires an {{#crossLink &quot;Model/added:event&quot;}}{{/crossLink}} event.
         *
         * @method add
         * @param {Number|String|*|Component} component ID, definition or instance of a {{#crossLink &quot;Component&quot;}}Component{{/crossLink}} type or subtype.
         */
        add: function (component) {

            var componentId;
            var types;

            if (xeogl._isNumeric(component) || xeogl._isString(component)) {

                if (this.scene.types[component]) {

                    // Component type

                    type = component;

                    types = this.scene.types[type];

                    if (!types) {
                        this.warn(&quot;Component type not found: &#x27;&quot; + type + &quot;&#x27;&quot;);
                        return;
                    }

                    for (componentId in types) {
                        if (types.hasOwnProperty(componentId)) {
                            this._add(types[componentId]);
                        }
                    }

                    return;

                } else {

                    // Component ID

                    component = this.scene.components[component];

                    if (!component) {
                        this.warn(&quot;Component not found: &quot; + xeogl._inQuotes(component));
                        return;
                    }
                }

            } else if (xeogl._isObject(component)) {

                // Component config given

                var type = component.type || &quot;xeogl.Component&quot;;

                if (!xeogl._isComponentType(type)) {
                    this.error(&quot;Not a xeogl component type: &quot; + type);
                    return;
                }

                component = new window[type](this.scene, component);

            }

            if (component.scene !== this.scene) {

                // Component in wrong Scene

                this.warn(&quot;Attempted to add component from different xeogl.Scene: &quot; + xeogl._inQuotes(component.id));
                return;
            }

            // Add component to this map

            if (this.components[component.id]) {

                // Component already in this Model
                return;
            }

            this.components[component.id] = component;

            // Register component for its type

            types = this.types[component.type];

            if (!types) {
                types = this.types[component.type] = {};
            }

            types[component.id] = component;

            this.numComponents++;

            // Remove component when it&#x27;s destroyed

            var self = this;

            this._onDestroyed[component.id] = component.on(&quot;destroyed&quot;, function () {
                self._remove(component);
            });

            if (component.isType(&quot;xeogl.Entity&quot;)) {

                // Insert the dummy transform above
                // each entity we just loaded

                var rootTransform = component.transform;

                if (!rootTransform) {

                    component.transform = self._dummyRootTransform;

                } else {

                    while (rootTransform.parent) {

                        if (rootTransform.id === self._dummyRootTransform.id) {

                            // Since transform hierarchies may contain
                            // transforms that share the same parents, there is potential to find
                            // our dummy root transform while walking up an entity&#x27;s transform
                            // path, when that path is joins a path that belongs to an Entity that
                            // we processed earlier

                            return;
                        }

                        rootTransform = rootTransform.parent;
                    }

                    if (rootTransform.id !== self._dummyRootTransform.id) {
                        rootTransform.parent = self._dummyRootTransform;
                    }
                }
            }

            if (component.worldBoundary) {
                this._onWorldBoundaryUpdated[component.id] = component.worldBoundary.on(&quot;updated&quot;, this._updated, this);
                if (!this._aabbDirty) {
                    this._setAABBDirty();
                }
            }

            /**
             * Fired whenever an individual {{#crossLink &quot;Component&quot;}}{{/crossLink}} is added to this {{#crossLink &quot;Model&quot;}}{{/crossLink}}.
             * @event added
             * @param value {Component} The {{#crossLink &quot;Component&quot;}}{{/crossLink}} that was added.
             */
            this.fire(&quot;added&quot;, component);

            if (!this._dirty) {
                this._scheduleUpdate();
            }

            return component;
        },

        _scheduleUpdate: function () {
            if (!this._dirty) {
                this._dirty = true;
                xeogl.scheduleTask(this._notifyUpdated, this);
            }
        },

        _notifyUpdated: function () {

            /* Fired on the next {{#crossLink &quot;Scene/tick.animate:event&quot;}}{{/crossLink}} whenever
             * {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} were added or removed since the
             * last {{#crossLink &quot;Scene/tick.animate:event&quot;}}{{/crossLink}} event, to provide a batched change event
             * for subscribers who don&#x27;t want to react to every individual addition or removal on this Model.
             *
             * @event updated
             */
            this.fire(&quot;updated&quot;);
            this._dirty = false;
        },

        /**
         * Destroys all {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} in this Model.
         *
         * @method destroyAll
         */
        destroyAll: function () {

            this.iterate(function (component) {
                component.destroy();
            });
        },

        /**
         * Removes all {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} from this Model.
         *
         * @method removeAll
         */
        removeAll: function () {

            // this.iterate(function (component) {
            //     component.destroy();
            // });
        },

        _remove: function (component) {

            var componentId = component.id;

            if (component.scene !== this.scene) {
                this.warn(&quot;Attempted to remove component that&#x27;s not in same xeogl.Scene: &#x27;&quot; + componentId + &quot;&#x27;&quot;);
                return;
            }

            delete this.components[componentId];

            // Unsubscribe from component destruction

            component.off(this._onDestroyed[componentId]);
            delete this._onDestroyed[componentId];

            // Unregister component for its type

            var types = this.types[component.type];

            if (types) {
                delete types[component.id];
            }

            this.numComponents--;

            //

            if (component.worldBoundary) {
                component.worldBoundary.off(this._onWorldBoundaryUpdated[component.id]);
                delete this._onWorldBoundaryUpdated[component.id];
            }

            if (!this._aabbDirty) {
                this._setAABBDirty();
            }


            /**
             * Fired whenever an individual {{#crossLink &quot;Component&quot;}}{{/crossLink}} is removed from this {{#crossLink &quot;Model&quot;}}{{/crossLink}}.
             * @event removed
             * @param value {Component} The {{#crossLink &quot;Component&quot;}}{{/crossLink}} that was removed.
             */
            this.fire(&quot;removed&quot;, component);

            if (!this._dirty) {
                this._scheduleUpdate();
            }
        },

        /**
         * Iterates with a callback over the {{#crossLink &quot;Component&quot;}}Components{{/crossLink}} in this Model.
         *
         * @method iterate
         * @param {Function} callback Callback called for each {{#crossLink &quot;Component&quot;}}{{/crossLink}}.
         * @param {Object} [scope=this] Optional scope for the callback, defaults to this Model.
         */
        iterate: function (callback, scope) {
            scope = scope || this;
            var components = this.components;
            for (var componentId in components) {
                if (components.hasOwnProperty(componentId)) {
                    callback.call(scope, components[componentId]);
                }
            }
        },

        _props: {

            /**
             * The Local-to-World-space (modelling) {{#crossLink &quot;Transform&quot;}}{{/crossLink}} attached to this Model.
             *
             * Must be within the same {{#crossLink &quot;Scene&quot;}}{{/crossLink}} as this Model.
             *
             * Internally, the given {{#crossLink &quot;Transform&quot;}}{{/crossLink}} will be inserted above each top-most
             * {{#crossLink &quot;Transform&quot;}}Transform{{/crossLink}} that the Model attaches to
             * its {{#crossLink &quot;Entity&quot;}}Entities{{/crossLink}}.
             *
             * Fires an {{#crossLink &quot;Model/transform:event&quot;}}{{/crossLink}} event on change.
             *
             * @property transform
             * @type Transform
             */
            transform: {

                set: function (value) {

                    /**
                     * Fired whenever this Model&#x27;s {{#crossLink &quot;Model/transform:property&quot;}}{{/crossLink}} property changes.
                     *
                     * @event transform
                     * @param value The property&#x27;s new value
                     */
                    this._attach({
                        name: &quot;transform&quot;,
                        type: &quot;xeogl.Transform&quot;,
                        component: value,
                        sceneDefault: false,
                        onAttached: {
                            callback: this._transformUpdated,
                            scope: this
                        }
                    });
                },

                get: function () {
                    return this._attached.transform;
                }
            },

            /**
             * World-space 3D boundary enclosing all the components in this Model.
             *
             * If you call {{#crossLink &quot;Component/destroy:method&quot;}}{{/crossLink}} on this boundary, then
             * this property will be assigned to a fresh {{#crossLink &quot;Boundary3D&quot;}}{{/crossLink}} instance next
             * time you reference it.
             *
             * @property worldBoundary
             * @type Boundary3D
             * @final
             */
            worldBoundary: {

                get: function () {

                    if (!this._worldBoundary) {

                        var self = this;

                        this._worldBoundary = this.create({

                            type: &quot;xeogl.Boundary3D&quot;,

                            getDirty: function () {
                                if (self._aabbDirty) {
                                    self._buildAABB();
                                    self._aabbDirty = false;
                                    return true;
                                }
                                return false;
                            },

                            getAABB: function () {
                                return self._aabb;
                            }
                        });

                        this._worldBoundary.on(&quot;destroyed&quot;,
                            function () {
                                self._worldBoundary = null;
                            });
                    }

                    return this._worldBoundary;
                }
            }
        },

        _transformUpdated: function (transform) {
            this._dummyRootTransform.parent = transform;
        },

        _updated: function () {
            if (!this._aabbDirty) {
                this._setAABBDirty();
            }
        },

        _setAABBDirty: function () {
            this._aabbDirty = true;
            if (this._worldBoundary) {
                this._worldBoundary.fire(&quot;updated&quot;, true);
            }
        },

        _buildAABB: function () {

            if (!this._aabb) {
                this._aabb = xeogl.math.AABB3();
            }

            var xmin = 100000;
            var ymin = 100000;
            var zmin = 100000;
            var xmax = -100000;
            var ymax = -100000;
            var zmax = -100000;

            var component;
            var worldBoundary;
            var aabb;

            var components = this.components;

            for (var componentId in components) {
                if (components.hasOwnProperty(componentId)) {

                    component = components[componentId];

                    worldBoundary = component.worldBoundary;

                    if (worldBoundary) {

                        aabb = worldBoundary.aabb;

                        if (aabb[0] &lt; xmin) {
                            xmin = aabb[0];
                        }

                        if (aabb[1] &lt; ymin) {
                            ymin = aabb[1];
                        }

                        if (aabb[2] &lt; zmin) {
                            zmin = aabb[2];
                        }

                        if (aabb[3] &gt; xmax) {
                            xmax = aabb[3];
                        }

                        if (aabb[4] &gt; ymax) {
                            ymax = aabb[4];
                        }

                        if (aabb[5] &gt; zmax) {
                            zmax = aabb[5];
                        }
                    }
                }
            }

            this._aabb[0] = xmin;
            this._aabb[1] = ymin;
            this._aabb[2] = zmin;
            this._aabb[3] = xmax;
            this._aabb[4] = ymax;
            this._aabb[5] = zmax;
        },

        _destroy: function () {
            this.removeAll();
        }
    });

})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
